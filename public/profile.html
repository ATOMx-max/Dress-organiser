<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Profile | Dress Organizer</title>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />

  <style>
    :root{
      --bg1:#1e1b4b; --bg2:#312e81; --bg3:#4c1d95;
      --muted: rgba(255,255,255,0.12);
      --card-bg: rgba(255,255,255,0.08);
      --glass-border: rgba(255,255,255,0.15);
      --accent: #6366f1;
      --success: #4ade80;
      --danger: #f87171;
      --toast-z: 99999;
      --sidebar-w: 260px;
    }

    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%}
    body{
      font-family:"Inter",sans-serif;
      background: linear-gradient(135deg,var(--bg1),var(--bg2),var(--bg3));
      color:white;
      min-height:100vh;
      overflow:hidden;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    /* App shell */
    .app {
      display:flex;
      height:100vh;
      width:100%;
      position:relative;
    }

    /* SIDEBAR: hidden on small screens, toggleable */
    .sidebar {
      width:var(--sidebar-w);
      max-width:calc(var(--sidebar-w));
      background: rgba(255,255,255,0.06);
      border-right:1px solid var(--glass-border);
      padding:22px;
      display:flex;
      flex-direction:column;
      transform:translateX(0);
      transition: transform .38s cubic-bezier(.2,.9,.2,1), backdrop-filter .3s;
      z-index:30;
      backdrop-filter: blur(8px);
      box-shadow: 0 8px 30px rgba(0,0,0,0.4);
    }

    /* Closed state - used on small screens */
    .sidebar.closed {
      transform: translateX(calc(-1 * (var(--sidebar-w) + 14px)));
    }

    /* sidebar header and items */
    .logo { font-size:1.25rem; font-weight:700; margin-bottom:18px; display:flex; align-items:center; gap:10px; }
    .logo .brand-icon { width:36px; height:36px; border-radius:8px; display:flex; align-items:center; justify-content:center; background:linear-gradient(135deg,#818cf8,#c084fc); box-shadow:0 6px 20px rgba(129,140,248,0.12); }
    .nav-list { display:flex; flex-direction:column; gap:8px; margin-top:8px; }
    .nav-item {
      display:flex; align-items:center; gap:12px; padding:10px 12px; border-radius:10px; cursor:pointer;
      transition: all .18s ease; color: #fff; font-weight:500; font-size:0.98rem;
    }
    .nav-item:hover { background: rgba(255,255,255,0.06); transform: translateX(6px); }
    .nav-item.active { background: rgba(255,255,255,0.12); font-weight:700; }

    /* icon-only collapsed items (very small screens) */
    .nav-item .label { display:inline-block; }
    .nav-item .icon { font-size:1.15rem; width:22px; text-align:center; }

    /* MAIN area */
    .main {
      flex:1;
      overflow-y:auto;
      padding:28px 28px 120px 28px; /* leave space for mobile bottom nav */
      position:relative;
      transition: filter .25s ease;
    }

    /* header top with toggle button */
    .topbar {
      display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:18px;
    }
    .top-left { display:flex; align-items:center; gap:12px; }
    .sidebar-toggle {
      display:inline-flex; align-items:center; justify-content:center;
      width:44px;height:44px;border-radius:10px;background:rgba(255,255,255,0.06); border:1px solid rgba(255,255,255,0.06);
      cursor:pointer;font-weight:700;font-size:18px;
    }
    .page-title { font-size:1.4rem; font-weight:700; background:linear-gradient(135deg,#fff,#e0e7ff); -webkit-background-clip:text; -webkit-text-fill-color:transparent; }

    .top-actions { display:flex; gap:10px; align-items:center; }

    /* content cards */
    .card {
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.12);
      padding:18px;
      margin-bottom:18px;
      border-radius:12px;
      backdrop-filter: blur(8px);
      transition: transform .32s cubic-bezier(.2,.9,.2,1), box-shadow .32s;
    }
    .card:hover { transform: translateY(-6px); box-shadow: 0 18px 60px rgba(0,0,0,0.45); }

    /* profile image */
    .profile-area { display:flex; gap:18px; align-items:center; flex-wrap:wrap; }
    .profile-pic { width:110px; height:110px; border-radius:50%; object-fit:cover; border:4px solid rgba(255,255,255,0.04); box-shadow: 0 8px 30px rgba(0,0,0,0.45); }
    .upload-btn { margin-top:10px; padding:8px 14px; border-radius:10px; background: rgba(255,255,255,0.08); border:1px solid rgba(255,255,255,0.12); cursor:pointer; }

    /* info rows */
    .info-row { display:flex; justify-content:space-between; gap:10px; padding:12px 0; border-bottom:1px solid rgba(255,255,255,0.04); align-items:center; }
    .info-row:last-child{ border-bottom:none; }
    .info-actions { display:flex; gap:8px; align-items:center; }

    .edit-btn { padding:8px 12px; border-radius:10px; background: rgba(255,255,255,0.06); border:1px solid rgba(255,255,255,0.08); cursor:pointer; }

    .actions { display:flex; gap:12px; margin-top:12px; flex-wrap:wrap; }
    .action-btn { padding:10px 16px; border-radius:12px; background: rgba(255,255,255,0.08); border:1px solid rgba(255,255,255,0.12); cursor:pointer; font-weight:700; }
    .action-danger { background: rgba(255,50,50,0.12); border:1px solid rgba(255,50,50,0.14); }

    /* backup area */
    .backup-box { display:flex; gap:12px; flex-wrap:wrap; margin-top:12px; }

    /* modals */
    .modal-bg { position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:60; background: rgba(0,0,0,0.55); }
    .modal { width:92%; max-width:520px; background: rgba(255,255,255,0.06); padding:18px; border-radius:12px; border:1px solid rgba(255,255,255,0.12); }
    .input { width:100%; padding:12px; margin-top:10px; border-radius:10px; border:1px solid rgba(255,255,255,0.12); background: rgba(255,255,255,0.03); color:#fff; }

    /* toast */
    #toastBox { position: fixed; top: 18px; right: 18px; z-index:var(--toast-z); display:flex; flex-direction:column; gap:10px; }
    .toast { padding:12px 16px; border-radius:10px; backdrop-filter: blur(6px); font-weight:700; animation: toastIn .35s ease; }
    .toast.success { background: rgba(50,255,120,0.08); border-left:4px solid var(--success); color:#e6ffee; }
    .toast.error { background: rgba(255,80,80,0.06); border-left:4px solid var(--danger); color:#ffecec; }
    @keyframes toastIn{ from{opacity:0; transform:translateX(10px)} to{opacity:1; transform:none} }

    /* bottom nav for mobile */
    .bottom-nav {
      display:none;
      position:fixed;
      left:50%;
      transform:translateX(-50%);
      bottom:12px;
      z-index:70;
      width:calc(100% - 28px);
      max-width:720px;
      background: rgba(255,255,255,0.04);
      border-radius:14px;
      padding:8px;
      display:flex;
      justify-content:space-around;
      gap:8px;
      border:1px solid rgba(255,255,255,0.06);
      backdrop-filter: blur(8px);
    }
    .bottom-btn { flex:1; padding:10px 8px; border-radius:10px; text-align:center; cursor:pointer; font-weight:700; }

    /* responsive behaviour */
    @media (max-width:1000px){
      .sidebar { position:fixed; left:0; top:0; bottom:0; height:100vh; }
      .main { padding-left:20px; padding-right:20px; }
    }

    @media (max-width:820px){
      .app { overflow:hidden; }
      .main { padding-bottom:140px; } /* more space for bottom nav */
    }

    @media (max-width:720px){
      .sidebar { transform: translateX(calc(-1 * (var(--sidebar-w) + 14px))); } /* default closed on small */
      .sidebar.open { transform: translateX(0); }
      .sidebar-toggle { display:inline-flex; }
      .bottom-nav { display:flex; }
      /* dim the main when sidebar open */
      .main.dim { filter: blur(3px) brightness(.86); pointer-events:none; }
    }

    /* collapse sidebar labels to icons only on very small screens */
    @media (max-width:420px){
      .sidebar { width:86px; --sidebar-w:86px; padding:14px; }
      .logo { justify-content:center; font-size:1rem; }
      .nav-item { justify-content:center; padding:10px 6px; }
      .nav-item .label { display:none; }
      .nav-item .icon { font-size:1.35rem; }
      .profile-area { flex-direction:column; align-items:center; }
      .profile-pic{ width:90px; height:90px; }
      .page-title { font-size:1.1rem; }
    }

    /* small improvements */
    .muted { color: rgba(255,255,255,0.7); font-size:0.95rem; }
    .small { font-size:0.9rem; opacity:0.9; }
    .center { text-align:center; }

  </style>
</head>
<body>
  <div class="app">
    <!-- Sidebar -->
    <aside id="sidebar" class="sidebar closed" aria-hidden="true">
      <div class="logo">
        <div class="brand-icon">üëó</div>
        <div style="display:flex;flex-direction:column;">
          <div style="font-weight:700">Dress Organizer</div>
          <div style="font-size:12px;opacity:.8">My Wardrobe</div>
        </div>
      </div>

      <nav class="nav-list" aria-label="Main navigation">
        <div class="nav-item" onclick="location.href='dashboard.html'">
          <span class="icon">üè†</span><span class="label">Dashboard</span>
        </div>
        <div class="nav-item" onclick="location.href='all-dresses.html'">
          <span class="icon">üëó</span><span class="label">All Dresses</span>
        </div>
        <div class="nav-item" onclick="location.href='upload.html'">
          <span class="icon">‚¨ÜÔ∏è</span><span class="label">Upload</span>
        </div>
        <div class="nav-item" onclick="location.href='manage.html'">
          <span class="icon">üìÇ</span><span class="label">Manage</span>
        </div>
        <div class="nav-item" onclick="location.href='search.html'">
          <span class="icon">üîç</span><span class="label">Search</span>
        </div>
        <div class="nav-item" onclick="location.href='favourites.html'">
          <span class="icon">‚ù§Ô∏è</span><span class="label">Favourites</span>
        </div>
        <div class="nav-item active" onclick="location.href='profile.html'">
          <span class="icon">‚öôÔ∏è</span><span class="label">Profile</span>
        </div>
        <div style="flex:1"></div>
        <div class="nav-item" onclick="logout()">
          <span class="icon">üö™</span><span class="label">Logout</span>
        </div>
      </nav>
    </aside>

    <!-- Main -->
    <main id="main" class="main" role="main">
      <div class="topbar">
        <div class="top-left">
          <button id="sidebarToggle" class="sidebar-toggle" aria-label="Toggle sidebar">‚ò∞</button>
          <div>
            <div class="page-title">Your Profile</div>
            <div class="small muted">Manage your account, backup & preferences</div>
          </div>
        </div>

        <div class="top-actions">
          <button class="action-btn" onclick="openPasswordModal()">üîê Change Password</button>
          <button class="action-btn action-danger" onclick="openDeleteModal()">üóë Delete Account</button>
        </div>
      </div>

      <!-- Profile card -->
      <section class="card">
        <div class="profile-area">
          <div style="display:flex;flex-direction:column;align-items:center">
            <img id="profilePic" src="default.jpg" class="profile-pic" alt="Profile picture" />
            <label class="upload-btn" title="Upload new photo">
              Upload New Photo
              <input type="file" id="picInput" hidden accept="image/*">
            </label>
          </div>

          <div style="flex:1;min-width:220px">
            <div style="display:flex;align-items:center;justify-content:space-between">
              <div>
                <div id="name" style="font-weight:800;font-size:1.1rem">‚Äî</div>
                <div id="email" class="muted small">‚Äî</div>
              </div>
              <div style="text-align:right">
                <div id="verifyBadge" class="small"></div>
                <div style="height:6px"></div>
                <button class="edit-btn" onclick="editName()">Edit Name</button>
              </div>
            </div>

            <div style="margin-top:12px">
              <div style="display:flex;gap:10px;flex-wrap:wrap">
                <button class="action-btn" onclick="location.href='manage.html'">‚öôÔ∏è Manage</button>
                <button class="action-btn" onclick="location.href='upload.html'">üì§ Upload</button>
                <button class="action-btn" onclick="location.href='favourites.html'">‚≠ê Favourites</button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Info card -->
      <section class="card">
        <div class="info-row">
          <span>Username</span>
          <div>
            <span id="username">‚Äî</span>
            <div style="display:inline-block;margin-left:10px"><button class="edit-btn" onclick="editUsername()">Edit</button></div>
          </div>
        </div>

        <div class="info-row">
          <span>Status</span>
          <span id="verifyBadge2" class="muted">‚Äî</span>
        </div>

        <div class="info-row">
          <span>Joined</span>
          <span id="joined">‚Äî</span>
        </div>

        <div class="info-row" style="border-bottom:none;">
          <span>Actions</span>
          <div class="info-actions">
            <button class="action-btn" onclick="downloadBackup()">üì¶ Export Backup</button>
            <button class="action-btn" onclick="document.getElementById('importInput').click()">üì• Import Backup</button>
          </div>
        </div>

        <input type="file" id="importInput" accept=".json" hidden onchange="handleImport(event)">
      </section>

      <!-- Other cards / placeholders -->
      <section class="card center">
        <div style="font-weight:800; margin-bottom:8px">Quick Stats</div>
        <div class="small muted">Open Dashboard to see live stats</div>
      </section>

      <!-- Modals -->
      <div id="passwordModal" class="modal-bg" onclick="if(event.target===this) closePasswordModal()">
        <div class="modal" role="dialog" aria-modal="true">
          <h3>Change Password</h3>
          <input id="curPass" class="input" type="password" placeholder="Current Password" />
          <input id="newPass" class="input" type="password" placeholder="New Password (min 6 chars)" />
          <div style="display:flex;gap:10px;margin-top:12px;">
            <button class="action-btn" onclick="changePassword()">Update</button>
            <button class="action-btn action-danger" onclick="closePasswordModal()">Cancel</button>
          </div>
        </div>
      </div>

      <div id="deleteModal" class="modal-bg" onclick="if(event.target===this) closeDeleteModal()">
        <div class="modal" role="dialog" aria-modal="true">
          <h3>Delete Account</h3>
          <p style="opacity:.9">Type <b>DELETE</b> to confirm.</p>
          <input id="confirmDeleteInput" class="input" placeholder="DELETE" />
          <div style="display:flex;gap:10px;margin-top:12px;">
            <button class="action-btn action-danger" onclick="deleteAccount()">Delete</button>
            <button class="action-btn" onclick="closeDeleteModal()">Cancel</button>
          </div>
        </div>
      </div>

      <div id="restoreModal" class="modal-bg" onclick="if(event.target===this) closeRestoreModal()">
        <div class="modal" role="dialog" aria-modal="true">
          <h3>Restore Preview</h3>
          <p class="small muted">Choose what you want to restore</p>
          <label style="display:block;margin-top:10px"><input type="checkbox" id="restoreSections" checked> Sections</label>
          <label style="display:block"><input type="checkbox" id="restoreDresses" checked> Dresses</label>

          <div class="restore-preview-list" id="previewList" style="margin-top:12px; max-height:220px; overflow:auto; border-radius:8px; padding:8px; background: rgba(255,255,255,0.02)"></div>

          <div style="display:flex;gap:10px;margin-top:12px;">
            <button class="action-btn" onclick="confirmRestore()">Restore Selected</button>
            <button class="action-btn action-danger" onclick="closeRestoreModal()">Cancel</button>
          </div>
        </div>
      </div>

      <!-- Toast box -->
      <div id="toastBox" aria-live="polite"></div>

    </main>
  </div>

  <!-- Bottom nav (mobile) -->
  <div class="bottom-nav" role="navigation" aria-label="Mobile navigation">
    <div class="bottom-btn" onclick="location.href='dashboard.html'">üè†</div>
    <div class="bottom-btn" onclick="location.href='upload.html'">üì§</div>
    <div class="bottom-btn" onclick="location.href='search.html'">üîç</div>
    <div class="bottom-btn" onclick="location.href='favourites.html'">‚≠ê</div>
    <div class="bottom-btn" onclick="toggleSidebar()" id="quickSidebarBtn">‚ò∞</div>
  </div>

  <script>
    // API URL (keeps your existing behavior)
    const API_URL = window.location.origin.includes("localhost")
      ? "http://localhost:8080"
      : (window.location.origin.includes("dress-organiser") ? "https://dress-organiser.onrender.com" : window.location.origin);

    /* ---------------------------
       UI helpers
    --------------------------- */
    function showToast(msg, type="success") {
      const box = document.getElementById("toastBox");
      const t = document.createElement("div");
      t.className = `toast ${type}`;
      t.textContent = msg;
      box.appendChild(t);
      setTimeout(()=>{ t.style.opacity="0"; t.style.transform="translateX(20px)"; },2500);
      setTimeout(()=> t.remove(), 3200);
    }

    // Sidebar toggling
    const sidebarEl = document.getElementById("sidebar");
    const mainEl = document.getElementById("main");
    const sidebarToggleBtn = document.getElementById("sidebarToggle");

    function openSidebar() {
      sidebarEl.classList.remove("closed");
      sidebarEl.classList.add("open");
      sidebarEl.setAttribute("aria-hidden","false");
      mainEl.classList.add("dim");
    }
    function closeSidebar() {
      sidebarEl.classList.remove("open");
      sidebarEl.classList.add("closed");
      sidebarEl.setAttribute("aria-hidden","true");
      mainEl.classList.remove("dim");
    }
    function toggleSidebar() {
      if (sidebarEl.classList.contains("open")) closeSidebar(); else openSidebar();
    }

    // make toggle button work
    sidebarToggleBtn.addEventListener("click", (e) => {
      e.stopPropagation();
      toggleSidebar();
    });

    // close sidebar when clicking outside on small screens
    document.addEventListener("click", (e) => {
      if (window.innerWidth <= 720) {
        if (!sidebarEl.contains(e.target) && !sidebarToggleBtn.contains(e.target)) {
          closeSidebar();
        }
      }
    });

    // keyboard escape to close
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape") closeSidebar();
    });

    /* ---------------------------
       EXISTING PROFILE LOGIC (kept intact)
    --------------------------- */

    async function loadUser() {
      try {
        const res = await fetch(`${API_URL}/api/me`, { credentials:"include" });
        if (!res.ok) return location.href="login.html";
        const user = await res.json();

        document.getElementById("name").textContent = user.name || "Not set";
        document.getElementById("username").textContent = user.username || "Not set";
        document.getElementById("email").textContent = user.email;
        document.getElementById("joined").textContent = new Date(user.joined).toLocaleDateString();

        document.getElementById("profilePic").src = user.profilePic || "default.jpg";

        const verifiedHtml = user.verified ? `<span style="color:#4ade80;">Verified</span>` : `<span style="color:#f87171;">Not Verified</span>`;
        document.getElementById("verifyBadge").innerHTML = verifiedHtml;
        document.getElementById("verifyBadge2").innerHTML = verifiedHtml;

        // store logged in name for feedback etc (keeps compatibility with other pages)
        localStorage.setItem('loggedInUser', user.name || (user.email ? user.email.split('@')[0] : 'User'));
      } catch (err) {
        console.error(err);
        showToast("Failed to load user","error");
      }
    }

    function editName() {
      let newName = prompt("Enter new name:");
      if (!newName) return showToast("Name unchanged","error");

      fetch(`${API_URL}/api/update-name`,{
        method:"POST",
        credentials:"include",
        headers:{ "Content-Type":"application/json" },
        body:JSON.stringify({ name:newName })
      })
      .then(async r => {
        if (r.ok) { await loadUser(); showToast("Name updated"); }
        else {
          const d = await r.json().catch(()=>({}));
          showToast(d.message || "Failed","error");
        }
      });
    }

    function editUsername() {
      let u = prompt("Enter new username:");
      if (!u) return showToast("Username unchanged","error");

      fetch(`${API_URL}/api/update-username`,{
        method:"POST",
        credentials:"include",
        headers:{ "Content-Type":"application/json" },
        body:JSON.stringify({ username:u })
      })
      .then(async r => {
        if (r.ok) { await loadUser(); showToast("Username updated"); }
        else {
          const d = await r.json().catch(()=>({}));
          showToast(d.message || "Failed","error");
        }
      });
    }

    // upload profile photo (keeps existing endpoint)
    document.getElementById("picInput").addEventListener("change", async (e)=>{
      const file = e.target.files[0];
      if (!file) return;

      const form = new FormData();
      form.append("image", file);

      try {
        const res = await fetch(`${API_URL}/api/upload-profile-pic`,{
          method:"POST",
          credentials:"include",
          body: form
        });

        if (res.ok) {
          showToast("Photo updated");
          await loadUser();
        } else {
          const d = await res.json().catch(()=>({}));
          showToast(d.message || "Upload failed","error");
        }
      } catch (err) {
        console.error(err);
        showToast("Network error","error");
      }
    });

    // password modal functions (kept)
    function openPasswordModal(){ document.getElementById("passwordModal").style.display="flex"; }
    function closePasswordModal(){ document.getElementById("passwordModal").style.display="none"; }

    async function changePassword() {
      const currentPassword = document.getElementById('curPass').value;
      const newPassword = document.getElementById('newPass').value;

      if (!currentPassword || !newPassword)
        return showToast("All fields required","error");

      try {
        const res = await fetch(`${API_URL}/api/change-password`,{
          method:"POST",
          credentials:"include",
          headers:{ "Content-Type":"application/json" },
          body:JSON.stringify({ currentPassword,newPassword })
        });

        if (res.ok) {
          showToast("Password updated");
          closePasswordModal();
        } else {
          const d = await res.json().catch(()=>({}));
          showToast(d.message || "Failed","error");
        }
      } catch (err) {
        console.error(err);
        showToast("Network error","error");
      }
    }

    // delete modal functions
    function openDeleteModal(){ document.getElementById("deleteModal").style.display="flex"; }
    function closeDeleteModal(){ document.getElementById("deleteModal").style.display="none"; }

    async function deleteAccount() {
      if (document.getElementById('confirmDeleteInput').value !== "DELETE")
        return showToast("Type DELETE to confirm","error");

      try {
        const res = await fetch(`${API_URL}/api/delete-account`,{
          method:"DELETE",
          credentials:"include"
        });

        if (res.ok) {
          showToast("Account deleted","error");
          setTimeout(()=> location.href="login.html", 1000);
        } else {
          const d = await res.json().catch(()=>({}));
          showToast(d.message || "Failed","error");
        }
      } catch (err) {
        console.error(err);
        showToast("Network error","error");
      }
    }

    // backup export
    function downloadBackup() {
      window.location.href = `${API_URL}/api/backup`;
    }

    /* ---------------------------
       IMPORT / RESTORE (kept behavior)
    --------------------------- */
    let importData = null;

    async function handleImport(event) {
      const file = event.target.files[0];
      if (!file) return;

      const text = await file.text();
      try {
        importData = JSON.parse(text);
      } catch {
        importData = null;
        return showToast("Invalid JSON","error");
      }

      // Show Preview
      const list = document.getElementById("previewList");
      list.innerHTML = "";

      list.innerHTML += `<p style="font-weight:700;margin-bottom:6px">Preview</p>`;
      list.innerHTML += `<p><b>Sections:</b> ${Array.isArray(importData.sections) ? importData.sections.length : 0}</p>`;
      list.innerHTML += `<p><b>Dresses:</b> ${Array.isArray(importData.dresses) ? importData.dresses.length : 0}</p>`;

      (importData.dresses || []).slice(0,5).forEach(d => {
        list.innerHTML += `<div style="opacity:.9; padding:6px 0; border-bottom:1px dashed rgba(255,255,255,0.03)">${d.name || 'Untitled'}</div>`;
      });

      openRestoreModal();
    }

    function openRestoreModal() { document.getElementById("restoreModal").style.display="flex"; }
    function closeRestoreModal() { document.getElementById("restoreModal").style.display="none"; }

    async function confirmRestore() {
      if (!importData) return showToast("Nothing to import","error");

      const restoreSections = document.getElementById("restoreSections").checked;
      const restoreDresses = document.getElementById("restoreDresses").checked;

      if (!restoreSections && !restoreDresses)
        return showToast("Select at least one option","error");

      const payload = {
        sections: restoreSections ? importData.sections || [] : [],
        dresses: restoreDresses ? importData.dresses || [] : []
      };

      try {
        // note: original file used /api/import endpoint ‚Äî keep that
        const res = await fetch(`${API_URL}/api/import`,{
          method:"POST",
          credentials:"include",
          headers:{ "Content-Type":"application/json" },
          body: JSON.stringify(payload)
        });

        if (res.ok) {
          showToast("Restore complete!");
          closeRestoreModal();
        } else {
          const d = await res.json().catch(()=>({}));
          showToast(d.message || "Restore failed","error");
        }
      } catch (err) {
        console.error(err);
        showToast("Network error","error");
      }
    }

    // logout
    function logout() {
      fetch(`${API_URL}/logout`, { method:"POST", credentials:"include" }).finally(() => {
        localStorage.clear();
        location.href="login.html";
      });
    }

    /* ---------------------------
       Init
    --------------------------- */
    (function init(){
      loadUser();

      // close sidebar by default on small screens
      if (window.innerWidth <= 720) closeSidebar(); else sidebarEl.classList.remove('closed');

      // quick toggle button (bottom nav)
      document.getElementById('quickSidebarBtn')?.addEventListener('click', toggleSidebar);

      // tidy up when resizing
      window.addEventListener('resize', () => {
        if (window.innerWidth > 720) {
          // ensure sidebar visible on desktop
          sidebarEl.classList.remove('closed');
          sidebarEl.classList.remove('open');
          sidebarEl.setAttribute('aria-hidden','false');
          mainEl.classList.remove('dim');
        } else {
          // default to closed on small
          sidebarEl.classList.add('closed');
          sidebarEl.setAttribute('aria-hidden','true');
          mainEl.classList.remove('dim');
        }
      });
    })();
  </script>
</body>
</html>
