<!-- FULL FINAL DASHBOARD HTML ‚Äî UPDATED WITH BUTTON NOTIFICATION -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard | Dress Organizer</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      background: linear-gradient(135deg, #1e1b4b, #312e81, #4c1d95);
      font-family: "Inter", sans-serif;
      min-height: 100vh;
      overflow-x: hidden;
      padding-bottom: 90px;
      color: white;
    }

    /* ORBS */
    .orb { position: absolute; border-radius:50%; filter: blur(80px); opacity:0.15; z-index:0; animation: float 20s infinite ease-in-out; }
    .orb-1{ background:linear-gradient(135deg,#818cf8,#c084fc); width:500px;height:500px; top:-200px; left:-150px;}
    .orb-2{ background:linear-gradient(135deg,#f472b6,#fb923c); width:400px;height:400px; bottom:-150px; right:-100px; animation-delay:5s;}
    .orb-3{ background:linear-gradient(135deg,#06b6d4,#3b82f6); width:350px;height:350px; top:40%; left:50%; animation-delay:10s;}
    @keyframes float { 0%,100%{transform:translate(0,0) scale(1);} 33%{transform:translate(50px,-50px) scale(1.1);} 66%{transform:translate(-30px,30px) scale(0.9);} }

    .container { max-width:1400px; margin:0 auto; padding:30px 20px; position:relative; z-index:10; }

    /* HEADER */
    .header { display:flex; justify-content:space-between; align-items:center; margin-bottom:40px; gap:16px; flex-wrap:wrap; }
    .brand { display:flex; align-items:center; gap:12px; }
    .brand-icon { width:48px;height:48px;border-radius:12px; background:linear-gradient(135deg,#818cf8,#c084fc); display:flex;align-items:center;justify-content:center; font-size:24px;color:white; box-shadow:0 8px 24px rgba(129,140,248,0.3); }
    .brand h1 { font-size:1.6rem; font-weight:700; background:linear-gradient(135deg,#fff,#e0e7ff); -webkit-background-clip:text; -webkit-text-fill-color:transparent; }

    /* USER SECTION */
    .user-section { display:flex; align-items:center; gap:12px; flex:1; justify-content:flex-end; flex-wrap:wrap; }
    .avatar { width:54px;height:54px;border-radius:50%; background:#2b1f5f; display:flex;align-items:center; justify-content:center; font-size:24px; color:white; border:3px solid rgba(255,255,255,0.12); overflow:hidden; transition:.3s; }
    .avatar img { width:100%; height:100%; object-fit:cover; border-radius:50%; }
    .avatar:hover { transform:scale(1.06); }

    .btn-ghost { padding:10px 14px; border-radius:12px; border:1px solid rgba(255,255,255,0.12); background:rgba(255,255,255,0.06); color:white; font-weight:600; cursor:pointer; transition:.2s; }
    .btn-ghost:hover { background:rgba(255,255,255,0.12); transform:translateY(-2px); }
    .feedback-btn { padding:10px 14px;border-radius:12px; background: linear-gradient(135deg,#f472b6,#fb923c); border:none; color:white; font-weight:700; cursor:pointer; }

    .typing::after { content:""; width:2px;height:1.2em;background:white;display:inline-block;margin-left:4px; animation: blink 1s infinite; }
    @keyframes blink { 50% { opacity:0; } }

    /* STATS */
    .stats { display:grid; grid-template-columns:repeat(auto-fit,minmax(180px,1fr)); gap:18px; margin-bottom:24px; }
    .stat-card { padding:20px;border-radius:18px; background:rgba(255,255,255,0.08); text-align:center; border:1px solid rgba(255,255,255,0.15); backdrop-filter:blur(16px); }
    .stat-number { font-size:1.8rem; font-weight:800; background:linear-gradient(135deg,#818cf8,#c084fc); -webkit-background-clip:text;-webkit-text-fill-color:transparent; }
    .stat-label { color:#c7d2fe; margin-top:6px; }

    /* GRID */
    .grid { display:grid; grid-template-columns:repeat(auto-fit, minmax(250px,1fr)); gap:24px; margin-top:30px; }
    .card { padding:32px 26px;border-radius:20px; background:rgba(255,255,255,0.08); border:1px solid rgba(255,255,255,0.15); backdrop-filter:blur(16px); cursor:pointer; transition:.3s; position:relative; overflow:hidden; }
    .card:hover { transform:translateY(-8px) scale(1.03); box-shadow:0 14px 32px rgba(0,0,0,0.3); border-color:rgba(255,255,255,0.25); }
    .card-icon { font-size:2rem; margin-bottom:10px; }
    .card-title { font-size:1.2rem; font-weight:700; margin-bottom:6px; }
    .card-description { font-size:0.9rem; color:#c7d2fe; }

    /* MOBILE NAV */
    .bottom-nav { display:none !important; position:fixed; bottom:0; left:0; width:100%; height:70px; background:rgba(20,20,40,0.75); border-top:1px solid rgba(255,255,255,0.15); backdrop-filter:blur(12px); z-index:9999; padding:0 8px; }
    @media (max-width:850px){ .bottom-nav{display:flex !important;} }
    .nav-item { flex:1; text-align:center; color:#e0e7ff; font-size:0.78rem; cursor:pointer; padding-top:6px; }
    .nav-item span { display:block; font-size:1.5rem; margin-bottom:2px; }

    /* üåü UPDATED BIRTHDAY BUTTON NOTIFICATION üåü */
    #bdayNotification {
      position: fixed;
      top: 16px;
      left: 50%;
      transform: translateX(-50%) scale(0.88);
      padding: 10px 26px;
      background: linear-gradient(135deg, #f472b6, #fb923c);
      border-radius: 50px;
      color: white;
      font-weight: 700;
      font-size: 0.95rem;
      cursor: pointer;
      display: none;
      z-index: 999999;
      box-shadow: 0 6px 20px rgba(0,0,0,0.25);
      transition: opacity .3s ease, transform .25s ease;
    }
    #bdayNotification:hover {
      transform: translateX(-50%) scale(1.05);
    }

    /* üéâ Birthday Screen (unchanged) */
    /* ... (kept same ‚Äì will send in PART 2) ... */

  </style>
</head>

<body>
  <!-- Birthday Surprise -->
  <div id="birthdayScreen" class="bday-bg" aria-hidden="true">
    <div id="closeBday" title="Close">‚úï</div>

    <div class="balloons" aria-hidden="true">
      <div class="balloon b1"></div>
      <div class="balloon b2"></div>
      <div class="balloon b3"></div>
      <div class="balloon b4"></div>
      <div class="balloon b5"></div>
      <div class="balloon b6"></div>
      <div class="balloon b7"></div>
    </div>

    <div id="heartsContainer" aria-hidden="true"
         style="position:absolute; inset:0; pointer-events:none; z-index:99996;"></div>

    <audio id="bdayMusic" loop preload="auto">
      <source src="birthday-song.mp3" type="audio/mpeg" />
    </audio>

    <div class="bday-card animated-card" id="animatedCard" role="button" tabindex="0">
      <div class="card-face card-front">
        <div style="padding: 8px 28px 28px;">
          <div class="bday-title" id="greetingLine">A Special Message for My Love</div>
          <div class="bday-sub" id="subGreeting">Tap to open, my heartbeat‚Ä¶ ‚ù§Ô∏èüéÅ</div>
          <div class="sparkles" id="sparklesContainer"></div>
        </div>
      </div>

      <div class="card-face card-inside">
        <div style="padding: 18px 22px;">
          <div class="bday-title" id="insideGreeting">üéâ Happy Birthday, My Love! üéâ</div>

          <div id="personalMsg" class="bday-sub muted"
               style="text-align:left; line-height:1.35;">
            My Love‚Ä¶ on your special day, I want to remind you of something simple but true:
            <strong>You are the most beautiful chapter of my life.</strong>
            Thank you for loving me every single day.
            <strong>Happy Birthday ‚ù§Ô∏èüéâ</strong>
          </div>

          <div id="secondMsg" class="muted"
               style="opacity:1; margin-top:18px; font-size:1rem; text-align:left;"></div>

          <div id="loveFade"
               style="opacity:0; font-size:1.3rem; font-weight:700; margin-top:22px; text-align:center;">
            I Love You, My Love ‚ù§Ô∏è
          </div>

          <div style="margin-top:14px; text-align:center;">
            <button class="bday-cta" id="continueBtn">Continue to Dashboard</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Confetti Lib -->
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

  <!-- MAIN SCRIPT -->
  <script>
    function go(p){ window.location.href = p; }

    async function logout(){
      fetch("/logout",{ method:"POST", credentials:"include" })
        .finally(()=>{ localStorage.removeItem("loggedInUser"); go("login.html"); });
    }

    function typeText(el, text, delay=40){
      el.textContent = "";
      let i = 0;
      const timer = setInterval(() => {
        if(i >= text.length){ clearInterval(timer); return; }
        el.textContent += text[i++];
      }, delay);
    }

    function typeEffectPromise(el, text, speed=30){
      return new Promise(resolve=>{
        el.textContent = "";
        let i = 0;
        const T = () => {
          if(i < text.length){
            el.textContent += text[i++];
            setTimeout(T, speed);
          } else resolve();
        };
        T();
      });
    }

    async function loadUser(){
      const r = await fetch("/api/me", { credentials:"include" });
      if(!r.ok){ go("login.html"); return; }
      const u = await r.json();
      window.__CURRENT_USER = u;

      const name = u.name || u.email.split("@")[0];

      // DP FIX ‚úî (shows uploaded profile picture)
      const avatar = document.getElementById("avatar");
      if(u.profilePic){
        avatar.innerHTML = `<img src="${u.profilePic}" alt="DP">`;
      } else {
        avatar.textContent = name[0].toUpperCase();
      }

      const hour = new Date().getHours();
      let greet = "Hello";
      if(hour < 12) greet = "Good morning";
      else if(hour < 17) greet = "Good afternoon";
      else greet = "Good evening";

      typeText(document.getElementById("typingLine1"), `${greet}, ${name} üëã`);
      typeText(document.getElementById("typingLine2"), "Here‚Äôs your wardrobe overview‚Ä¶");
    }

    async function loadStats(){
      const r = await fetch("/api/stats", { credentials:"include" });
      if(!r.ok) return;
      const s = await r.json();
      document.getElementById("dressCount").textContent = s.dresses;
      document.getElementById("sectionCount").textContent = s.sections;
      document.getElementById("recentUploads").textContent = (s.recent || []).length;
    }

    loadUser();
    loadStats();
    setInterval(loadStats, 60000);

    /* üéâ BIRTHDAY CHECK SYSTEM */
    async function checkBirthday(){
      try{
        let user = window.__CURRENT_USER;

        if(!user){
          const r = await fetch("/api/me",{ credentials:"include" });
          if(!r.ok) return;
          user = await r.json();
        }

        const targetEmail = "sjs36931@gmail.com";
        const birthday = "16-11";

        const d = new Date();
        const dd = String(d.getDate()).padStart(2,"0");
        const mm = String(d.getMonth()+1).padStart(2,"0");

        const todayStr = `${dd}-${mm}`;

        if(user.email !== targetEmail || todayStr !== birthday) return;

        const shown = localStorage.getItem("bdayShown");

        // First time today ‚Üí show popup
        if(shown !== new Date().toDateString()){
          setTimeout(()=> showBirthdayScreen(user), 500);
          return;
        }

        // Already shown ‚Üí show BUTTON NOTIFICATION ‚úî
        showBirthdayNotification();

      }catch(e){ console.error(e); }
    }

    setTimeout(checkBirthday, 800);

    /* üéâ Show Birthday Screen */
    function showBirthdayScreen(user){
      localStorage.setItem("bdayShown", new Date().toDateString());

      const screen = document.getElementById("birthdayScreen");
      const card = document.getElementById("animatedCard");
      const music = document.getElementById("bdayMusic");

      const name = user.name || user.email.split("@")[0];
      document.getElementById("greetingLine").textContent = `A Special Message for ${name}`;
      document.getElementById("insideGreeting").textContent = `üéâ Happy Birthday, ${name}! üéâ`;

      screen.style.display = "flex";

      populateSparkles();
      createHearts();

      setTimeout(()=> confetti({ particleCount:110, spread:90, origin:{y:0.62} }),300);

      // flip card
      card.addEventListener("click", openCard);
      card.addEventListener("keydown", (e)=>{ if(e.key==="Enter"||e.key===" ") openCard(); });

      function openCard(){
        if(card.classList.contains("opened")) return;
        card.classList.add("opened");

        // play music
        try{
          music.volume = 0;
          music.play().catch(()=>{});
          let v = 0;
          const fade = setInterval(()=>{
            v += 0.04;
            music.volume = v;
            if(v >= 0.6) clearInterval(fade);
          },120);
        }catch{}

        setTimeout(()=> confetti({ particleCount:260, spread:170, origin:{y:0.5} }), 600);

        const secondText =
          "On this day‚Ä¶ I just want you to feel loved, cherished, and held close. You deserve all the happiness in the world, My Love. üíó";

        const secondMsg = document.getElementById("secondMsg");
        const loveEl = document.getElementById("loveFade");

        setTimeout(()=>{
          typeEffectPromise(secondMsg, secondText, 28).then(()=>{
            setTimeout(()=>{
              loveEl.style.opacity = "1";
              loveEl.style.animation = "shimmer 2.6s linear infinite";
            }, 400);
          });
        }, 1500);
      }

      document.getElementById("continueBtn").onclick = closeBirthday;
      document.getElementById("closeBday").onclick = closeBirthday;
    }

    /* üéâ CLOSE Birthday Popup */
    function closeBirthday(){
      const screen = document.getElementById("birthdayScreen");
      const music = document.getElementById("bdayMusic");

      try{
        let v = music.volume;
        const fade = setInterval(()=>{
          v -= 0.06;
          music.volume = v;
          if(v <= 0){ music.pause(); clearInterval(fade); }
        },80);
      }catch{}

      screen.classList.add("fadeOut");
      setTimeout(()=>{
        screen.style.display = "none";
        screen.classList.remove("fadeOut");
      },500);
    }

    /* ‚ú® Sparkles */
    function populateSparkles(){
      const cont = document.getElementById("sparklesContainer");
      cont.innerHTML = "";
      for(let i=0;i<12;i++){
        const s = document.createElement("div");
        s.className = "sparkle";
        s.style.left = (6 + Math.random()*86) + "%";
        s.style.top = (12 + Math.random()*120) + "px";
        s.style.animationDelay = (Math.random()*1.3)+"s";
        const size = 6 + Math.random()*8;
        s.style.width = size+"px";
        s.style.height = size+"px";
        cont.appendChild(s);
      }
    }

    /* ‚ù§Ô∏è Hearts */
    let heartsInterval = null;
    function createHearts(){
      const cont = document.getElementById("heartsContainer");
      if(heartsInterval) clearInterval(heartsInterval);

      const colors = ["#ff6fb5","#ff9bd0","#ffc0d9","#ff7fb0","#ffd6ea","#ffb3d9"];

      heartsInterval = setInterval(()=>{
        const h = document.createElement("div");
        h.className = "heart";
        h.textContent = "‚ù§Ô∏è";
        h.style.left = (8 + Math.random()*84) + "%";
        h.style.fontSize = (14 + Math.random()*26)+"px";
        h.style.color = colors[Math.floor(Math.random()*colors.length)];
        cont.appendChild(h);
        setTimeout(()=>{ try{ cont.removeChild(h);}catch{} },4000);
      },500);
    }

    /* ‚≠ê Birthday Notification Button */
    function showBirthdayNotification(){
      const box = document.getElementById("bdayNotification");
      if(!box) return;

      box.style.display = "block";
      box.style.opacity = "0";
      box.style.transform = "translateX(-50%) scale(0.88)";

      setTimeout(()=>{
        box.style.opacity = "1";
        box.style.transform = "translateX(-50%) scale(1)";
      },20);

      box.onclick = ()=>{
        box.style.display = "none";
        showBirthdayScreen(window.__CURRENT_USER);
      };
    }

  </script>

</body>
</html>
