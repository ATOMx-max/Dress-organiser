<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Upload Dress | Dress Organizer</title>

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: "Poppins", sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #fff;
      min-height: 100vh;
      padding: 15px;
      overflow-x: hidden;
      position: relative;
    }

    .bg-particles { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 0; }
    .particle { position: absolute; background: rgba(255, 255, 255, 0.1); border-radius: 50%; animation: float 15s infinite ease-in-out; }

    @keyframes float {
      0%,100% { transform: translateY(0) translateX(0); opacity: 0; }
      10%,90% { opacity: 1; }
      100% { transform: translateY(-100vh) translateX(100px); opacity: 0; }
    }

    header {
      display: flex; justify-content: space-between; align-items: center;
      max-width: 1200px; margin: 0 auto 30px; padding: 0 10px;
      position: relative; z-index: 10; animation: slideDown 0.6s ease;
    }
    @keyframes slideDown { from { opacity: 0; transform: translateY(-30px);} to { opacity: 1; transform: translateY(0);} }
    header h1 { font-size: clamp(1.4rem,5vw,2rem); font-weight:700; text-shadow:0 4px 20px rgba(0,0,0,0.3); }

    .btn {
      background: linear-gradient(135deg,#4f46e5 0%,#7c3aed 100%);
      border:none;color:white;font-size:clamp(0.85rem,2.5vw,1rem);font-weight:600;
      border-radius:50px;padding:10px 20px;cursor:pointer;
      transition:all .3s ease;
      box-shadow:0 5px 20px rgba(79,70,229,0.3);
      position:relative;overflow:hidden;
    }
    .btn:hover { transform:translateY(-3px) scale(1.05); }

    .btn.logout { background:linear-gradient(135deg,#ef4444,#dc2626); }

    .upload-container {
      background:rgba(255,255,255,0.95);backdrop-filter:blur(10px);
      border-radius:25px;padding:clamp(20px,5vw,40px);max-width:650px;margin:0 auto;
      color:#333;box-shadow:0 20px 60px rgba(0,0,0,0.15);
      animation:fadeInUp 0.6s ease;position:relative;z-index:10;
    }
    @keyframes fadeInUp { from {opacity:0;transform:translateY(40px);} to {opacity:1;transform:translateY(0);} }

    h2 { color:#4f46e5;font-size:clamp(1.3rem,4vw,1.8rem);margin-bottom:25px;text-align:center; }

    label { display:block;margin-top:20px;font-weight:600;color:#374151;font-size:0.95rem; }
    input[type="text"], select {
      width:100%;padding:14px 18px;border:2px solid #e5e7eb;border-radius:15px;
      font-size:15px;transition:all .3s; background:white;
    }
    input[type="text"]:focus, select:focus {
      border-color:#667eea; outline:none;
      box-shadow:0 0 0 4px rgba(102,126,234,0.15);
    }

    input[type="file"] { display:none; }

    .file-upload-btn { width:100%;padding:16px;border:3px dashed #d1d5db;border-radius:15px;text-align:center;cursor:pointer; }
    .file-upload-btn.active { border-color:#4f46e5;background:#eef2ff; }

    .preview img {
      max-width:100%; border-radius:20px; max-height:300px;
      box-shadow:0 10px 30px rgba(0,0,0,0.2); margin-top:10px;
    }

    .status { text-align:center;margin-top:20px;font-weight:600;min-height:24px;font-size:1rem; }
    .success { color:#16a34a; }
    .error { color:#dc2626; }

    .progress-container { display:none;margin-top:15px;background:#e5e7eb;border-radius:10px; }
    .progress-bar { height:10px;width:0%;background:#4f46e5; }
  </style>
</head>

<body>

  <div class="bg-particles" id="bgParticles"></div>

  <header>
    <h1>üëó Upload a Dress</h1>

    <div style="display:flex; gap:10px;">
      <button class="btn" onclick="window.location.href='dashboard.html'">‚Üê Dashboard</button>
      <button class="btn logout" id="logoutBtn">Logout</button>
    </div>
  </header>

  <div class="upload-container">
    <h2>üì∏ Add a New Dress</h2>

    <form id="uploadForm" enctype="multipart/form-data">
      <label for="name">Dress Name:</label>
      <input type="text" id="name" name="name" placeholder="e.g. Red Party Gown" required />

      <label for="section">Section:</label>
      <select id="section" name="section" required>
        <option value="">Select Section</option>
      </select>

      <label for="category">Category:</label>
      <select id="category" name="category" required>
        <option value="">Select Category</option>
      </select>

      <label for="image">Select Image:</label>
      <input type="file" id="image" name="image" accept="image/*" required />

      <label for="image" class="file-upload-btn" id="fileUploadBtn">
        üì∑ Click to upload image
      </label>

      <div class="preview" id="preview"></div>

      <div class="progress-container" id="progressContainer">
        <div class="progress-bar" id="progressBar"></div>
      </div>

      <button type="submit" class="btn" style="width:100%; margin-top:25px;">‚ú® Upload Dress</button>
    </form>

    <p id="status" class="status"></p>

    <div class="link-group" style="margin-top:25px; text-align:center;">
      <a href="search.html" class="btn" style="text-decoration:none;">üîç Search</a>
      <a href="manage.html" class="btn" style="text-decoration:none;">‚öô Manage</a>
    </div>
  </div>

  <script>
    const API_URL = window.location.origin.includes("localhost")
      ? "http://localhost:8080"
      : "https://dress-organiser.onrender.com";

    const sectionSelect = document.getElementById("section");
    const categorySelect = document.getElementById("category");
    const fileInput = document.getElementById("image");
    const fileBtn = document.getElementById("fileUploadBtn");
    const preview = document.getElementById("preview");
    const statusText = document.getElementById("status");
    const progressBar = document.getElementById("progressBar");
    const progressContainer = document.getElementById("progressContainer");

    if (!localStorage.getItem("loggedInUser")) {
      window.location.href = "login.html";
    }

    // Load sections
    async function loadSections() {
      const res = await fetch(`${API_URL}/api/sections`, { credentials:"include" });
      const data = await res.json();

      sectionSelect.innerHTML = `<option value="">Select Section</option>`;
      data.forEach(sec => {
        sectionSelect.innerHTML += `<option value="${sec.name}">${sec.name}</option>`;
      });

      sectionSelect.onchange = () => {
        const selected = data.find(s => s.name === sectionSelect.value);
        categorySelect.innerHTML = `<option value="">Select Category</option>`;
        if (selected) {
          selected.categories.forEach(c => {
            categorySelect.innerHTML += `<option value="${c}">${c}</option>`;
          });
        }
      };
    }
    loadSections();

    // File preview
    fileInput.addEventListener("change", e => {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = () => {
        preview.innerHTML = `<img src="${reader.result}"/>`;
        fileBtn.classList.add("active");
      };
      reader.readAsDataURL(file);
    });

    // Upload logic
    document.getElementById("uploadForm").addEventListener("submit", e => {
      e.preventDefault();

      const formData = new FormData(e.target);

      const xhr = new XMLHttpRequest();
      xhr.open("POST", `${API_URL}/api/dresses`);
      xhr.withCredentials = true;

      xhr.upload.onprogress = event => {
        if (event.lengthComputable) {
          const percent = Math.round((event.loaded / event.total) * 100);
          progressContainer.style.display = "block";
          progressBar.style.width = percent + "%";
        }
      };

      xhr.onload = () => {
        if (xhr.status === 200) {
          statusText.textContent = "‚úÖ Dress uploaded successfully!";
          statusText.className = "status success";
          progressBar.style.width = "100%";

          setTimeout(() => location.reload(), 1500);
        } else {
          statusText.textContent = "‚ùå Upload failed!";
          statusText.className = "status error";
        }
      };

      xhr.onerror = () => {
        statusText.textContent = "‚ùå Network error!";
        statusText.className = "status error";
      };

      xhr.send(formData);
    });

    // Logout
    document.getElementById("logoutBtn").onclick = () => {
      localStorage.removeItem("loggedInUser");
      window.location.href = "login.html";
    };
  </script>

</body>
</html>
