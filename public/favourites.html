<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>‚≠ê Favourite Dresses ‚Äî Dress Organizer (Premium)</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg-1: #0b1020;
      --panel: rgba(255,255,255,0.03);
      --glass: rgba(255,255,255,0.04);
      --accent-1: #8b5cf6; /* purple */
      --accent-2: #ec4899; /* pink */
      --accent-3: #06b6d4; /* cyan */
      --muted: rgba(200,210,255,0.18);
      --glass-border: rgba(255,255,255,0.06);
      --card-shadow: 0 18px 60px rgba(2,6,23,0.55);
    }

    html,body{height:100%}
    body{
      margin:0;
      font-family:"Inter",system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;
      background:
        radial-gradient(800px 400px at 10% 10%, rgba(139,92,246,0.09), transparent 8%),
        radial-gradient(600px 300px at 90% 90%, rgba(236,72,153,0.06), transparent 8%),
        linear-gradient(180deg,var(--bg-1) 0%, #0f1724 100%);
      color:#eef2ff;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      min-height:100vh;
      padding:28px;
      box-sizing:border-box;
    }

    /* Floating topbar */
    .topbar {
      position: sticky;
      top:18px;
      z-index:30;
      display:flex;
      gap:16px;
      align-items:center;
      justify-content:space-between;
      max-width:1300px;
      margin:0 auto 22px;
      padding:12px 18px;
      border-radius:14px;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border:1px solid var(--glass-border);
      box-shadow: 0 6px 30px rgba(2,6,23,0.5);
      backdrop-filter: blur(8px) saturate(120%);
      transition: transform .22s ease;
    }
    .topbar .left { display:flex; gap:14px; align-items:center; }
    .brand {
      display:flex; gap:12px; align-items:center;
    }
    .brand-badge {
      width:44px;height:44px;border-radius:11px;
      background:linear-gradient(135deg,var(--accent-1),var(--accent-2));
      display:flex;align-items:center;justify-content:center;font-size:20px; box-shadow: 0 10px 30px rgba(139,92,246,0.12);
    }
    .title { font-weight:800; font-size:1.05rem; letter-spacing: -0.2px; color: #fff; }
    .subtitle { font-size:0.85rem; color:var(--muted); margin-top:2px; }

    .top-actions { display:flex; gap:10px; align-items:center; }

    .btn {
      background: linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border: 1px solid var(--glass-border);
      color: #fff;
      padding:10px 14px;
      border-radius:10px;
      cursor:pointer;
      font-weight:600;
      transition: transform .14s ease, box-shadow .14s ease;
    }
    .btn:hover { transform: translateY(-4px); box-shadow: 0 10px 30px rgba(2,6,23,0.45); }

    .btn.primary {
      background: linear-gradient(90deg, var(--accent-1), var(--accent-2));
      border: none;
      box-shadow: 0 10px 30px rgba(139,92,246,0.12), 0 2px 6px rgba(0,0,0,0.2);
    }
    .btn.ghost { background: transparent; border:1px solid rgba(255,255,255,0.06); color:var(--muted); }

    /* gallery area */
    .page {
      max-width:1300px;
      margin: 0 auto;
      padding: 18px;
      box-sizing:border-box;
    }

    .info-row {
      display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:18px;
    }
    .info-left { display:flex; flex-direction:column; gap:4px; }
    .lead { font-size:1.1rem; font-weight:700; }
    .muted-small { color:var(--muted); font-size:0.92rem; }

    /* Grid */
    .grid {
      display:grid;
      grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
      gap:22px;
      align-items:start;
    }

    /* Card (premium) */
    .card {
      border-radius:16px;
      overflow:hidden;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border:1px solid rgba(255,255,255,0.04);
      box-shadow: var(--card-shadow);
      transform: translateY(18px) scale(.995);
      opacity:0;
      transition: transform .45s cubic-bezier(.2,.9,.25,1), opacity .45s ease;
      display:flex;
      flex-direction:column;
    }
    .card.enter { transform: translateY(0) scale(1); opacity:1; }

    .thumb {
      position:relative;
      height: 320px;
      background: linear-gradient(180deg, rgba(0,0,0,0.35), rgba(255,255,255,0.02));
      overflow: hidden;
    }
    .thumb img {
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
      transition: transform 0.8s cubic-bezier(.2,.9,.25,1);
    }
    .card:hover .thumb img { transform: scale(1.06); }

    .meta {
      padding:14px;
      display:flex;
      flex-direction:column;
      gap:8px;
    }
    .meta h3 { margin:0; font-size:1.05rem; font-weight:700; color:#fff; }
    .meta p { margin:0; color:var(--muted); font-size:0.92rem; }

    .actions {
      display:flex; gap:8px; padding:12px; border-top:1px solid rgba(255,255,255,0.02); justify-content:center;
      background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));
    }

    .small-btn {
      padding:8px 12px;
      border-radius:10px;
      cursor:pointer;
      border:1px solid rgba(255,255,255,0.04);
      background: transparent;
      color:#fff;
      font-weight:600;
      transition: transform .12s ease;
    }
    .small-btn:hover { transform: translateY(-3px); }

    .small-btn.warn {
      border:1px solid rgba(255,60,80,0.18);
      background: linear-gradient(90deg, rgba(255,40,80,0.06), rgba(255,40,80,0.02));
      color:#ffdede;
    }
    .badge {
      position:absolute;
      left:12px;
      top:12px;
      background: linear-gradient(90deg,var(--accent-1),var(--accent-3));
      color:white;
      padding:6px 10px;
      border-radius:999px;
      font-weight:700;
      font-size:0.86rem;
      box-shadow: 0 8px 30px rgba(139,92,246,0.12);
    }

    /* skeleton */
    .skeleton {
      height:320px;
      background: linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.03));
      border-radius:12px;
      animation: shimmer 1.2s infinite linear;
    }
    @keyframes shimmer {
      0% { background-position: -200px 0; }
      100% { background-position: 200px 0; }
    }

    /* Preview modal (large, premium) */
    .modal {
      position:fixed; inset:0; display:flex; align-items:center; justify-content:center; z-index:2000;
      background: linear-gradient(0deg, rgba(1,2,6,0.6), rgba(1,2,6,0.6));
      opacity:0; pointer-events:none; transition: opacity .18s ease;
    }
    .modal.active { opacity:1; pointer-events:all; }

    .modal-card {
      width:94%; max-width:1100px; border-radius:14px; padding:18px; display:grid; grid-template-columns: 1fr 380px; gap:18px;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border:1px solid rgba(255,255,255,0.04);
      box-shadow: 0 30px 90px rgba(2,6,23,0.6);
      align-items:start;
    }
    .modal-left { display:flex; align-items:center; justify-content:center; background:#02040a; border-radius:10px; overflow:hidden; min-height:420px; }
    .modal-left img { max-width:100%; max-height:80vh; object-fit:contain; display:block; }

    .modal-right { color:var(--muted); display:flex; flex-direction:column; gap:12px; }
    .modal-right h2 { color:#fff; margin:0; font-size:1.4rem; font-weight:800; }
    .modal-right .meta-line { color:var(--muted); font-size:0.95rem; }

    .modal-controls { display:flex; gap:8px; margin-top:10px; flex-wrap:wrap; }

    .cta {
      padding:10px 14px; border-radius:10px; font-weight:700; cursor:pointer; border:none;
    }
    .cta.primary { background: linear-gradient(90deg,var(--accent-1),var(--accent-2)); color:white; }
    .cta.ghost { background: transparent; border:1px solid rgba(255,255,255,0.06); color:var(--muted); }

    /* Edit modal small */
    .edit {
      width:420px; max-width:94%; padding:14px; border-radius:12px; background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border:1px solid rgba(255,255,255,0.04);
      box-shadow: 0 20px 60px rgba(2,6,23,0.6);
    }
    .input, select {
      width:100%; padding:10px 12px; margin-top:8px; border-radius:10px; border:1px solid rgba(255,255,255,0.06);
      background:transparent; color:#fff; font-weight:600;
    }

    /* empty state */
    .empty {
      text-align:center; padding:80px 20px; color:var(--muted); grid-column:1/-1;
    }

    /* responsive */
    @media (max-width:980px){
      .modal-card { grid-template-columns: 1fr; }
      .modal-left { min-height:320px; }
      .thumb{ height:260px; }
    }
  </style>
</head>
<body>
  <div class="topbar" role="region" aria-label="Topbar">
    <div class="left">
      <div class="brand">
        <div class="brand-badge">üëó</div>
        <div>
          <div class="title">Dress Organizer ‚Äî Favourites</div>
          <div class="subtitle">Premium gallery ¬∑ quick actions</div>
        </div>
      </div>
    </div>

    <div class="top-actions" role="toolbar" aria-label="Actions">
      <button class="btn ghost" id="btn-back" title="Back to Dashboard">‚Üê Dashboard</button>
      <button class="btn" id="btn-refresh" title="Refresh">‚ü≥ Refresh</button>
      <button class="btn primary" id="btn-upload" title="Upload">Ôºã Upload</button>
    </div>
  </div>

  <main class="page" id="page">
    <div class="info-row">
      <div class="info-left">
        <div class="lead">Your favourite dresses ‚Äî curated ‚ú®</div>
        <div class="muted-small">Edit, preview, unfavourite or delete items. Changes take effect instantly.</div>
      </div>
      <div style="display:flex;gap:10px;align-items:center;">
        <div id="stats" style="color:var(--muted);font-weight:700">Loading‚Ä¶</div>
      </div>
    </div>

    <section id="grid" class="grid" aria-live="polite" aria-busy="true">
      <!-- cards injected here -->
    </section>
  </main>

  <!-- Preview Modal -->
  <div id="modal" class="modal" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal-card" role="document">
      <div class="modal-left" id="modalImageWrap">
        <img id="modalImage" src="" alt="Dress preview" />
      </div>

      <div class="modal-right">
        <h2 id="modalTitle">Dress Name</h2>
        <div class="meta-line" id="modalMeta">Section ‚Üí Category</div>
        <div class="meta-line" id="modalUploaded">Uploaded: ‚Äî</div>

        <div class="modal-controls" style="margin-top:12px;">
          <button id="modalToggleFav" class="cta ghost">‚òÖ Unfavourite</button>
          <button id="modalEdit" class="cta">‚úèÔ∏è Edit</button>
          <button id="modalDelete" class="cta ghost" style="color:#ffdede;border:1px solid rgba(255,60,80,0.12)">üóëÔ∏è Delete</button>
        </div>

        <div style="margin-top:auto;">
          <button id="modalClose" class="btn ghost" style="width:100%;">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Edit Panel (inline slide-in) -->
  <div id="editPanel" style="position:fixed; right:18px; bottom:18px; z-index:2100; pointer-events:none; opacity:0;">
    <div class="edit" role="dialog" aria-modal="false" id="editCard">
      <h3 style="margin:0 0 4px 0; color:#fff;">Edit Dress</h3>
      <div class="muted-small">Update name, section & category</div>

      <label class="muted-small" style="margin-top:10px">Name</label>
      <input id="editName" class="input" placeholder="Dress name" />

      <label class="muted-small">Section</label>
      <select id="editSection"></select>

      <label class="muted-small">Category</label>
      <select id="editCategory"></select>

      <div style="display:flex; gap:8px; justify-content:flex-end; margin-top:10px;">
        <button class="btn ghost" id="editCancel">Cancel</button>
        <button class="btn primary" id="editSave">Save</button>
      </div>
    </div>
  </div>

  <script>
    // dynamic API base (works on localhost + deployed)
    const API_BASE = (() => {
      const origin = window.location.origin;
      if (origin.includes('localhost') || origin.includes('127.0.0.1')) return origin + '/api';
      // if deploy uses same origin:
      return origin + '/api';
    })();

    // DOM
    const grid = document.getElementById('grid');
    const statsEl = document.getElementById('stats');
    const modal = document.getElementById('modal');
    const modalImage = document.getElementById('modalImage');
    const modalTitle = document.getElementById('modalTitle');
    const modalMeta = document.getElementById('modalMeta');
    const modalUploaded = document.getElementById('modalUploaded');
    const modalToggleFav = document.getElementById('modalToggleFav');
    const modalEdit = document.getElementById('modalEdit');
    const modalDelete = document.getElementById('modalDelete');
    const modalClose = document.getElementById('modalClose');

    const editPanel = document.getElementById('editPanel');
    const editName = document.getElementById('editName');
    const editSection = document.getElementById('editSection');
    const editCategory = document.getElementById('editCategory');
    const editSave = document.getElementById('editSave');
    const editCancel = document.getElementById('editCancel');

    const btnRefresh = document.getElementById('btn-refresh');
    const btnBack = document.getElementById('btn-back');
    const btnUpload = document.getElementById('btn-upload');

    // state
    let favourites = [];
    let sections = [];
    let currentId = null;      // for modal
    let editingId = null;      // for edit panel

    // helpers
    function esc(s){ return String(s||'').replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }
    function fmtDate(d){ try { return new Date(d).toLocaleString(); } catch(e){return '-';} }

    // skeleton loader
    function renderSkeleton(count=6){
      grid.innerHTML = '';
      for(let i=0;i<count;i++){
        const el = document.createElement('div');
        el.className = 'card';
        el.innerHTML = `
          <div class="thumb"><div class="skeleton" style="height:100%;"></div></div>
          <div class="meta"><div style="height:12px;width:60%;background:linear-gradient(90deg,rgba(255,255,255,0.02),rgba(255,255,255,0.03));border-radius:6px"></div>
          <div style="height:10px;width:40%;background:linear-gradient(90deg,rgba(255,255,255,0.02),rgba(255,255,255,0.03));border-radius:6px;margin-top:8px"></div></div>
          <div class="actions"></div>
        `;
        grid.appendChild(el);
      }
    }

    // load sections & favourites
    async function loadData(){
      renderSkeleton();
      statsEl.textContent = 'Loading‚Ä¶';
      try {
        const [fRes, sRes] = await Promise.all([
          fetch(API_BASE + '/favourites', { credentials:'include' }),
          fetch(API_BASE + '/sections', { credentials:'include' })
        ]);

        if (fRes.status === 401) {
          // not authorized ‚Äî redirect to login
          localStorage.removeItem('loggedInUser');
          window.location.href = 'login.html';
          return;
        }

        favourites = await fRes.json();
        sections = sRes.ok ? await sRes.json() : [];

        statsEl.textContent = `${favourites.length} favourite(s)`;
        renderGrid();
      } catch (err) {
        console.error('Load error', err);
        grid.innerHTML = `<div class="empty">Failed to load favourites ‚Äî check your network or sign in again.</div>`;
        statsEl.textContent = 'Error';
      }
    }

    // render gallery
    function renderGrid(){
      grid.innerHTML = '';
      if (!favourites || favourites.length === 0){
        grid.innerHTML = `<div class="empty">No favourite dresses yet ‚ú®<br>Mark dresses as favourite from other pages to see them here.</div>`;
        return;
      }

      favourites.forEach((d, idx)=>{
        const card = document.createElement('article');
        card.className = 'card';
        card.setAttribute('data-id', d._id);
        // build inner
        card.innerHTML = `
          <div class="thumb" role="button" aria-label="Open preview of ${esc(d.name||'Dress')}">
            <span class="badge">‚≠ê Favourite</span>
            <img loading="lazy" src="${esc(d.imageUrl)}" alt="${esc(d.name||'Dress')}" />
          </div>
          <div class="meta">
            <h3>${esc(d.name || 'Untitled')}</h3>
            <p>${esc(d.section || '‚Äî')} ‚Üí ${esc(d.category || '‚Äî')}</p>
          </div>
          <div class="actions">
            <button class="small-btn" data-action="preview" data-id="${d._id}">Preview</button>
            <button class="small-btn" data-action="edit" data-id="${d._id}">Edit</button>
            <button class="small-btn" data-action="unfav" data-id="${d._id}">üíî Unfav</button>
            <button class="small-btn warn" data-action="delete" data-id="${d._id}">Delete</button>
          </div>
        `;
        grid.appendChild(card);

        // staggered entrance animation
        setTimeout(()=> card.classList.add('enter'), 70 * idx);

      });

      // attach listeners (delegation)
      grid.querySelectorAll('[data-action]').forEach(btn=>{
        btn.addEventListener('click', (e)=>{
          const id = btn.getAttribute('data-id');
          const action = btn.getAttribute('data-action');
          if (action === 'preview') openPreview(id);
          if (action === 'edit') openEdit(id);
          if (action === 'unfav') toggleFavourite(id, { optimistic:true });
          if (action === 'delete') deleteDressConfirmed(id);
        });
      });

      // clicking thumbnail opens preview
      grid.querySelectorAll('.thumb').forEach(t=>{
        t.addEventListener('click', (e)=>{
          const card = t.closest('.card');
          const id = card.getAttribute('data-id');
          openPreview(id);
        });
      });
    }

    // Preview modal
    function openPreview(id){
      const d = favourites.find(x => x._id === id);
      if (!d) return;
      currentId = id;
      modalImage.src = d.imageUrl;
      modalTitle.textContent = d.name || 'Untitled';
      modalMeta.textContent = `${d.section || '‚Äî'} ‚Üí ${d.category || '‚Äî'}`;
      modalUploaded.textContent = 'Uploaded: ' + fmtDate(d.createdAt);
      modal.classList.add('active');
      modal.setAttribute('aria-hidden','false');

      modalToggleFav.textContent = d.isFavorite ? '‚òÖ Unfavourite' : '‚òÜ Favourite';
    }

    function closePreview(){
      currentId = null;
      modal.classList.remove('active');
      modal.setAttribute('aria-hidden','true');
      modalImage.src = '';
    }

    // toggle favourite (optimistic updates)
    async function toggleFavourite(id, opts={}) {
      // optimistic removal from list for unfavourite; if re-favouriting handle similarly
      try {
        const item = favourites.find(x=>x._id===id);
        if (!item) return;
        // toggle locally
        const wasFav = !!item.isFavorite;
        item.isFavorite = !wasFav;

        if (opts.optimistic && !item.isFavorite) {
          // remove visually
          favourites = favourites.filter(x => x._id !== id);
          renderGrid();
        } else {
          // update badge/button
          // re-render grid for simplicity
          renderGrid();
        }

        // call API
        const res = await fetch(API_BASE + '/dresses/' + id + '/favourite', {
          method: 'PUT', credentials:'include'
        });
        if (!res.ok) {
          // revert if failed
          if (opts.optimistic) {
            // reload all to be safe
            await loadData();
          } else {
            alert('Failed to update favourite');
            await loadData();
          }
          return;
        }
        const data = await res.json();
        // ensure local state sync
        if (data && typeof data.isFavorite !== 'undefined') {
          // remove if unfavourited
          if (!data.isFavorite) {
            favourites = favourites.filter(x => x._id !== id);
            renderGrid();
          } else {
            const idx = favourites.findIndex(x=>x._id===id);
            if (idx === -1 && data.isFavorite) {
              // if became fav but missing, just reload
              await loadData();
            } else {
              favourites[idx].isFavorite = data.isFavorite;
              renderGrid();
            }
          }
        } else {
          // safe reload
          await loadData();
        }
      } catch (err) {
        console.error('toggle fav err', err);
        if (opts.optimistic) await loadData();
      }
    }

    // delete with confirm
    async function deleteDressConfirmed(id){
      if (!confirm('Permanently delete this dress? This cannot be undone.')) return;
      try {
        const res = await fetch(API_BASE + '/dresses/' + id, { method: 'DELETE', credentials:'include' });
        if (!res.ok) {
          const body = await res.json().catch(()=>({}));
          alert(body.message || 'Delete failed');
          return;
        }
        favourites = favourites.filter(d => d._id !== id);
        renderGrid();
      } catch (err) {
        console.error('delete err', err);
        alert('Delete failed (network)');
      }
    }

    // modal actions
    modalClose.addEventListener('click', closePreview);
    modal.addEventListener('click', e => { if (e.target === modal) closePreview(); });
    modalToggleFav.addEventListener('click', async ()=>{
      if (!currentId) return;
      await toggleFavourite(currentId, { optimistic:true });
      closePreview();
    });
    modalDelete.addEventListener('click', async ()=>{
      if (!currentId) return;
      await deleteDressConfirmed(currentId);
      closePreview();
    });
    modalEdit.addEventListener('click', ()=>{
      if (!currentId) return;
      openEdit(currentId);
      closePreview();
    });

    // Edit flow
    function openEdit(id){
      const d = favourites.find(x => x._id === id);
      if (!d) return alert('Dress not found');
      editingId = id;

      // populate fields
      editName.value = d.name || '';
      fillSectionsSelect();
      // set selected section & categories
      if (d.section) editSection.value = d.section;
      fillCategoriesFor(d.section || (sections[0] && sections[0].name));
      if (d.category) editCategory.value = d.category;

      // reveal panel
      editPanel.style.opacity = 1;
      editPanel.style.pointerEvents = 'all';
      editPanel.style.transition = 'opacity .18s ease';
      // focus
      setTimeout(()=> editName.focus(), 120);
    }

    function closeEdit(){
      editingId = null;
      editPanel.style.opacity = 0;
      editPanel.style.pointerEvents = 'none';
      editPanel.style.transition = 'opacity .12s ease';
    }

    editCancel.addEventListener('click', (e)=>{
      e.preventDefault();
      closeEdit();
    });

    editSave.addEventListener('click', async (e)=>{
      e.preventDefault();
      if (!editingId) return;
      const payload = {
        name: editName.value.trim(),
        section: editSection.value,
        category: editCategory.value
      };
      if (!payload.name) return alert('Name required');
      try {
        editSave.disabled = true;
        editSave.textContent = 'Saving‚Ä¶';
        const res = await fetch(API_BASE + '/dresses/' + editingId, {
          method: 'PUT',
          headers: {'Content-Type':'application/json'},
          credentials:'include',
          body: JSON.stringify(payload)
        });
        const data = await res.json();
        if (!res.ok) {
          alert(data.message || 'Save failed');
          return;
        }
        // update local copy
        favourites = favourites.map(d => d._id === editingId ? ({...d, ...payload}) : d);
        renderGrid();
        closeEdit();
      } catch (err) {
        console.error('save err', err);
        alert('Save failed');
      } finally {
        editSave.disabled = false; editSave.textContent = 'Save';
      }
    });

    // fill sections & categories
    function fillSectionsSelect(){
      editSection.innerHTML = '';
      if (!sections || sections.length === 0){
        const opt = document.createElement('option'); opt.value=''; opt.textContent='‚Äî No sections ‚Äî';
        editSection.appendChild(opt);
        return;
      }
      sections.forEach(s=>{
        const opt = document.createElement('option'); opt.value = s.name; opt.textContent = s.name;
        editSection.appendChild(opt);
      });
    }
    function fillCategoriesFor(sectionName){
      editCategory.innerHTML = '';
      const sec = sections.find(s => s.name === sectionName);
      if (!sec || !sec.categories || sec.categories.length === 0){
        const opt=document.createElement('option'); opt.value=''; opt.textContent='‚Äî No categories ‚Äî'; editCategory.appendChild(opt); return;
      }
      sec.categories.forEach(c=>{
        const opt=document.createElement('option'); opt.value=c; opt.textContent=c; editCategory.appendChild(opt);
      });
    }
    editSection.addEventListener('change', ()=> fillCategoriesFor(editSection.value));

    // top actions
    btnRefresh.addEventListener('click', ()=> loadData());
    btnBack.addEventListener('click', ()=> window.location.href = 'dashboard.html');
    btnUpload.addEventListener('click', ()=> window.location.href = 'upload.html');

    // keyboard shortcuts
    window.addEventListener('keydown', (e)=>{
      if (e.key === 'Escape') {
        if (modal.classList.contains('active')) closePreview();
        if (editPanel.style.opacity === '1') closeEdit();
      }
    });

    // initial
    loadData();
  </script>
</body>
</html>
